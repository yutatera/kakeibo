<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>家計簿</title>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <style type="text/css">
    .sidebar {
      top:70px;
      position: -webkit-sticky;
      position: sticky;
    }
    body { padding-top: 70px; }
  </style>
</head>

<body>
  <!--ナビゲーションウィンドウ-->
  <nav class="navbar navbar-expand navbar-dark bg-dark fixed-top">
    <div class="navbar-brand">家計簿</div>
    <div class="navbar-nav">
      <a class="nav-item nav-link active" href="/">推移</a>
      <a class="nav-item nav-link" href="/future">予測</a>
      <a class="nav-item nav-link" href="/month">月毎・年毎</a>
    </div>
  </nav>
    
  <div class="container-fluid">
  <div class="row">
    <!--サイドバー-->
    <div class="col-2">
    <div class="sidebar">
    <ul class="nav flex-column">
      <li class="nav-item">
        <span data-feather="settings"></span>
        <span class="navbar-text">期間</span>
      </li>
      <ul class="list-unstyled ml-2">
        <li><select name="dataLen" id="dataLen"></select></li>
      </ul>
      <li class="nav-item">
        <span data-feather="align-left"></span>
        <span class="navbar-text">項目</span>
      </li>
      <ul class="list-unstyled ml-2">
        <li><input type="radio" name="radio" id="資産" value="資産" />資産</li>
        <li><input type="radio" name="radio" id="収支" value="収支" />収支</li>
        <li><input type="radio" name="radio" id="収入" value="収入" />収入</li>
        <li><input type="radio" name="radio" id="収入項目" value="収入項目" />収入項目</li>
        <li><input type="radio" name="radio" id="支出" value="支出" />支出</li>
        <li><input type="radio" name="radio" id="支出大項目" value="支出大項目" checked="checked" />支出大項目</li>
        <li><input type="radio" name="radio" id="支出小項目" value="支出小項目" />支出小項目</li>
        <li><select name="sishutuList" id="sishutuList"></select>
      </ul>
    </ul>
    </div>
    </div>

    <!--メイン-->
    <main role="main" class="col-md-10">
      <h1>推移グラフ</h1>
      <canvas id='graph' height="40%" width="100%"></canvas>
      <h1>推移テーブル</h1>
      <div id="tbl"></div>
    </main>
  </div>
  
  <script>
    var colors = [
        'rgb(  0,   0, 255)',
        'rgb(  0, 203, 255)',
        'rgb(255, 255,   0)',
        'rgb(216, 255, 204)',
        'rgb(  0, 255,   0)',
        'rgb(  0, 101,   0)',
        'rgb(255, 63,    0)',
        'rgb( 203,  0, 203)',
        'rgb(  0,   0,  50)'
    ]

    var trans = function(color, opacity) {
        var alpha = opacity === undefined ? 0.5 : 1 - opacity;
        return Color(color).alpha(alpha).rgbString();
    }

    function areaConfig(x, y){
    var data = {
        labels: x,
        datasets: []
    }
    for (i = 0; i< y.length; i++){
        var fill = true
        if(i > 0){
        fill = "-1"
        }
        val = Object.values(y[i])[0]
        val = val.slice(Math.max(val.length - x.length, 0) , val.length)
        data.datasets[i] = {
        backgroundColor: trans(colors[i % colors.length]),
        borderColor: colors[i % colors.length],
        data: val,
        label: Object.keys(y[i])[0],
        fill : fill
        }
    }
    var options = {
        elements: {
        line: {
            tension: 0.1
        }
        },
        scales: {
        yAxes: [{
            stacked: true,
            ticks: {
            beginAtZero: false
            }
        }]
        },
        legend: {
        display: true,
        }
    }
    var ret = {
        type: 'line',
        data: data,
        options: options
    }
    return ret
    }
    // アイコンの表示
    feather.replace()

    function makeTable(slct){
      fetch('/get_dataGraph')
        .then(function(response) {
            if (response.ok){
                return response.json();
            } else {
                return '{"x": ["200104", "200105", "200106", "200107", "200108", "200109", "200110", "200111", "200112", "200201", "200202", "200203", "200204", "200205", "200206", "200207", "200208", "200209", "200210", "200211", "200212", "200301", "200302", "200303", "200304", "200305", "200306", "200307", "200308", "200309", "200310", "200311", "200312", "200401", "200402", "200403"], "y": {"収入": [{"収入": [683136, 730751, 727404, 687472, 746171, 640840, 654468, 701337, 760635, 721327, 704362, 657362, 717571, 624011, 773369, 761045, 672992, 744705, 667086, 674945, 707703, 663950, 630278, 710340, 645767, 682179, 623197, 689002, 651379, 718123, 697573, 732034, 658828, 738022, 716930, 672781]}], "支出": [{"支出": [304843, 332489, 321045, 325690, 313601, 333915, 337203, 345072, 321137, 303929, 320978, 320441, 319028, 319341, 300875, 322952, 304155, 303453, 340495, 323743, 321044, 323769, 325980, 323484, 319070, 341049, 350710, 331636, 323615, 329762, 323292, 334894, 335763, 321242, 320476, 328542]}], "収支": [{"収支": [378293, 398262, 406359, 361782, 432570, 306925, 317265, 356265, 439498, 417398, 383384, 336921, 398543, 304670, 472494, 438093, 368837, 441252, 326591, 351202, 386659, 340181, 304298, 386856, 326697, 341130, 272487, 357366, 327764, 388361, 374281, 397140, 323065, 416780, 396454, 344239]}], "収入項目": [{"給与A": [517373, 548867, 531616, 584865, 583619, 512560, 530635, 537082, 571464, 564473, 543186, 534529, 519776, 508633, 588642, 578093, 536410, 556733, 512352, 503509, 522599, 559642, 526163, 544672, 534400, 579299, 521635, 579727, 527761, 590786, 522062, 564144, 516708, 599610, 526032, 538605]}, {"給与B": [165763, 181884, 195788, 102607, 162552, 128280, 123833, 164255, 189171, 156854, 161176, 122833, 197795, 115378, 184727, 182952, 136582, 187972, 154734, 171436, 185104, 104308, 104115, 165668, 111367, 102880, 101562, 109275, 123618, 127337, 175511, 167890, 142120, 138412, 190898, 134176]}], "支出小項目": [{"電気": [5679, 7069, 7145, 6630, 7523, 5766, 7015, 7893, 4119, 5052, 6433, 7127, 4553, 5568, 5396, 4498, 6313, 5450, 4872, 4265, 7415, 7379, 6293, 6594, 7114, 5387, 6070, 5339, 4068, 6515, 7649, 6115, 7233, 6348, 5095, 4879]}, {"ガス": [7946, 6435, 5538, 7630, 4494, 7524, 4271, 4889, 7479, 4616, 5335, 5778, 5528, 7822, 5685, 5629, 5170, 4471, 6650, 4815, 6031, 6867, 4164, 6097, 4154, 7672, 7996, 7197, 5242, 5518, 7590, 7527, 7731, 4158, 6555, 4841]}, {"水道": [4863, 6062, 7010, 6422, 6084, 6138, 5935, 6930, 6310, 5773, 7924, 7128, 5243, 5685, 6287, 7143, 5497, 4243, 7978, 5275, 4491, 5719, 6089, 6232, 5831, 6536, 7801, 5208, 5382, 4120, 7818, 5615, 5941, 5626, 6932, 4429]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"保険": [10542, 10900, 10887, 10036, 10481, 10304, 10807, 10447, 10749, 10312, 10286, 10116, 10242, 10679, 10268, 10157, 10170, 10456, 10653, 10043, 10114, 10465, 10476, 10267, 10682, 10775, 10185, 10864, 10120, 10074, 10187, 10902, 10232, 10056, 10926, 10064]}, {"医療": [8458, 9673, 5776, 5290, 7315, 7881, 7305, 9020, 5571, 6573, 7209, 6389, 7933, 5505, 7204, 6075, 6903, 7156, 7689, 6900, 5400, 7674, 9007, 9043, 6593, 8931, 7961, 9448, 9486, 7971, 5198, 9727, 7641, 6614, 5329, 5638]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}, {"その他": [12840, 18821, 11808, 14319, 13255, 16755, 18128, 13524, 17534, 14238, 11352, 11704, 12791, 19154, 12944, 14560, 11473, 18011, 18663, 19486, 11416, 15917, 14182, 14149, 13669, 18623, 18722, 12332, 15374, 13728, 11650, 18497, 16788, 19740, 12089, 10452]}], "支出大項目": [{"光熱水": [18488, 19566, 19693, 20682, 18101, 19428, 17221, 19712, 17908, 15441, 19692, 20033, 15324, 19075, 17368, 17270, 16980, 14164, 19500, 14355, 17937, 19965, 16546, 18923, 17099, 19595, 21867, 17744, 14692, 16153, 23057, 19257, 20905, 16132, 18582, 14149]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"医療・保険": [19000, 20573, 16663, 15326, 17796, 18185, 18112, 19467, 16320, 16885, 17495, 16505, 18175, 16184, 17472, 16232, 17073, 17612, 18342, 16943, 15514, 18139, 19483, 19310, 17275, 19706, 18146, 20312, 19606, 18045, 15385, 20629, 17873, 16670, 16255, 15702]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}], "資産": [{"資産": [11378293, 11776555, 12182914, 12544696, 12977266, 13284191, 13601456, 13957721, 14397219, 14814617, 15198001, 15534922, 15933465, 16238135, 16710629, 17148722, 17517559, 17958811, 18285402, 18636604, 19023263, 19363444, 19667742, 20054598, 20381295, 20722425, 20994912, 21352278, 21680042, 22068403, 22442684, 22839824, 23162889, 23579669, 23976123, 24320362]}]}}'.json()
            }
        })
        .then(function(dataGraph) {
          $("#tbl").empty();
          var txt = '<table class="table table-striped table-sm table-hover">'
          txt += '<thead><tr align="right">'
          txt += '<th>月</th>'
          for (var c = 0; c < dataGraph["y"][slct].length; c++){
            txt += '<th>'+ Object.keys(dataGraph["y"][slct][c])[0] + '</th>'
          }            
          txt += '</tr></thead>'
          txt += '<tbody>'
          for (var r = dataGraph["x"].length - 1; 0 <= r; r--) {
            txt += '<tr align="right">'
            txt += '<td>' + dataGraph["x"][r] + '</td>'
            for (var c = 0; c < dataGraph["y"][slct].length; c++){
              x = Object.values(dataGraph["y"][slct][c])[0][r]
              txt += '<td>' +  String(x).replace( /(\d)(?=(\d\d\d)+(?!\d))/g, '$1,') + '</td>'
            };
            txt += '</tr>'
          }
          txt += '</tbody>'
          txt += '</table>'
          $('#tbl').append(txt)
        })
    }

    function calcMonth(monthList, dataLen){
      switch(dataLen){
        case "全て": monthListTmp = monthList; break;   // 全て
        case "半年": monthListTmp = monthList.slice(Math.max(monthList.length - 6, 0) , monthList.length); break;
        case "1年": monthListTmp = monthList.slice(Math.max(monthList.length - 12, 0), monthList.length); break;
        case "2年": monthListTmp = monthList.slice(Math.max(monthList.length - 24, 0), monthList.length); break;
        case "3年": monthListTmp = monthList.slice(Math.max(monthList.length - 36, 0), monthList.length); break;
        case "5年": monthListTmp = monthList.slice(Math.max(monthList.length - 60, 0), monthList.length); break;
      }
      return monthListTmp
    }

    // グラフ・テーブルの更新
    function update(initFlag){
      fetch('/get_dataGraph')
        .then(function(response) {
            if (response.ok){
                return response.json();
            } else {
                return '{"x": ["200104", "200105", "200106", "200107", "200108", "200109", "200110", "200111", "200112", "200201", "200202", "200203", "200204", "200205", "200206", "200207", "200208", "200209", "200210", "200211", "200212", "200301", "200302", "200303", "200304", "200305", "200306", "200307", "200308", "200309", "200310", "200311", "200312", "200401", "200402", "200403"], "y": {"収入": [{"収入": [683136, 730751, 727404, 687472, 746171, 640840, 654468, 701337, 760635, 721327, 704362, 657362, 717571, 624011, 773369, 761045, 672992, 744705, 667086, 674945, 707703, 663950, 630278, 710340, 645767, 682179, 623197, 689002, 651379, 718123, 697573, 732034, 658828, 738022, 716930, 672781]}], "支出": [{"支出": [304843, 332489, 321045, 325690, 313601, 333915, 337203, 345072, 321137, 303929, 320978, 320441, 319028, 319341, 300875, 322952, 304155, 303453, 340495, 323743, 321044, 323769, 325980, 323484, 319070, 341049, 350710, 331636, 323615, 329762, 323292, 334894, 335763, 321242, 320476, 328542]}], "収支": [{"収支": [378293, 398262, 406359, 361782, 432570, 306925, 317265, 356265, 439498, 417398, 383384, 336921, 398543, 304670, 472494, 438093, 368837, 441252, 326591, 351202, 386659, 340181, 304298, 386856, 326697, 341130, 272487, 357366, 327764, 388361, 374281, 397140, 323065, 416780, 396454, 344239]}], "収入項目": [{"給与A": [517373, 548867, 531616, 584865, 583619, 512560, 530635, 537082, 571464, 564473, 543186, 534529, 519776, 508633, 588642, 578093, 536410, 556733, 512352, 503509, 522599, 559642, 526163, 544672, 534400, 579299, 521635, 579727, 527761, 590786, 522062, 564144, 516708, 599610, 526032, 538605]}, {"給与B": [165763, 181884, 195788, 102607, 162552, 128280, 123833, 164255, 189171, 156854, 161176, 122833, 197795, 115378, 184727, 182952, 136582, 187972, 154734, 171436, 185104, 104308, 104115, 165668, 111367, 102880, 101562, 109275, 123618, 127337, 175511, 167890, 142120, 138412, 190898, 134176]}], "支出小項目": [{"電気": [5679, 7069, 7145, 6630, 7523, 5766, 7015, 7893, 4119, 5052, 6433, 7127, 4553, 5568, 5396, 4498, 6313, 5450, 4872, 4265, 7415, 7379, 6293, 6594, 7114, 5387, 6070, 5339, 4068, 6515, 7649, 6115, 7233, 6348, 5095, 4879]}, {"ガス": [7946, 6435, 5538, 7630, 4494, 7524, 4271, 4889, 7479, 4616, 5335, 5778, 5528, 7822, 5685, 5629, 5170, 4471, 6650, 4815, 6031, 6867, 4164, 6097, 4154, 7672, 7996, 7197, 5242, 5518, 7590, 7527, 7731, 4158, 6555, 4841]}, {"水道": [4863, 6062, 7010, 6422, 6084, 6138, 5935, 6930, 6310, 5773, 7924, 7128, 5243, 5685, 6287, 7143, 5497, 4243, 7978, 5275, 4491, 5719, 6089, 6232, 5831, 6536, 7801, 5208, 5382, 4120, 7818, 5615, 5941, 5626, 6932, 4429]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"保険": [10542, 10900, 10887, 10036, 10481, 10304, 10807, 10447, 10749, 10312, 10286, 10116, 10242, 10679, 10268, 10157, 10170, 10456, 10653, 10043, 10114, 10465, 10476, 10267, 10682, 10775, 10185, 10864, 10120, 10074, 10187, 10902, 10232, 10056, 10926, 10064]}, {"医療": [8458, 9673, 5776, 5290, 7315, 7881, 7305, 9020, 5571, 6573, 7209, 6389, 7933, 5505, 7204, 6075, 6903, 7156, 7689, 6900, 5400, 7674, 9007, 9043, 6593, 8931, 7961, 9448, 9486, 7971, 5198, 9727, 7641, 6614, 5329, 5638]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}, {"その他": [12840, 18821, 11808, 14319, 13255, 16755, 18128, 13524, 17534, 14238, 11352, 11704, 12791, 19154, 12944, 14560, 11473, 18011, 18663, 19486, 11416, 15917, 14182, 14149, 13669, 18623, 18722, 12332, 15374, 13728, 11650, 18497, 16788, 19740, 12089, 10452]}], "支出大項目": [{"光熱水": [18488, 19566, 19693, 20682, 18101, 19428, 17221, 19712, 17908, 15441, 19692, 20033, 15324, 19075, 17368, 17270, 16980, 14164, 19500, 14355, 17937, 19965, 16546, 18923, 17099, 19595, 21867, 17744, 14692, 16153, 23057, 19257, 20905, 16132, 18582, 14149]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"医療・保険": [19000, 20573, 16663, 15326, 17796, 18185, 18112, 19467, 16320, 16885, 17495, 16505, 18175, 16184, 17472, 16232, 17073, 17612, 18342, 16943, 15514, 18139, 19483, 19310, 17275, 19706, 18146, 20312, 19606, 18045, 15385, 20629, 17873, 16670, 16255, 15702]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}], "資産": [{"資産": [11378293, 11776555, 12182914, 12544696, 12977266, 13284191, 13601456, 13957721, 14397219, 14814617, 15198001, 15534922, 15933465, 16238135, 16710629, 17148722, 17517559, 17958811, 18285402, 18636604, 19023263, 19363444, 19667742, 20054598, 20381295, 20722425, 20994912, 21352278, 21680042, 22068403, 22442684, 22839824, 23162889, 23579669, 23976123, 24320362]}]}}'.json()
            }
        })
        .then(function(dataGraph) {
          slct = $('input[name=radio]:checked').val()
          sishutuNum = $("#sishutuList option:selected").val();
          dataLen = $("#dataLen option:selected").val()
          if(initFlag == false){
            window.chart.destroy()
          }
          if(slct == "支出小項目"){
            chart = new Chart('graph', areaConfig(calcMonth(dataGraph["x"], dataLen), [dataGraph["y"][slct][sishutuNum]]))
          } else {
                chart = new Chart('graph', areaConfig(calcMonth(dataGraph["x"], dataLen), dataGraph["y"][slct]))
          }
          makeTable(slct)
        });

    }

    // selectBox(期間)のリスト設定
    for(j of ["全て", "半年", "1年", "2年", "3年", "5年"]){
      op = document.createElement("option")
      op.value = j
      op.text = j
      document.getElementById("dataLen").appendChild(op)
    }

    // selectBox(支出小項目)のリスト設定
    fetch('/get_dataGraph')
      .then(function(response) {
        if (response.ok){
            return response.json();
        } else {
            return '{"x": ["200104", "200105", "200106", "200107", "200108", "200109", "200110", "200111", "200112", "200201", "200202", "200203", "200204", "200205", "200206", "200207", "200208", "200209", "200210", "200211", "200212", "200301", "200302", "200303", "200304", "200305", "200306", "200307", "200308", "200309", "200310", "200311", "200312", "200401", "200402", "200403"], "y": {"収入": [{"収入": [683136, 730751, 727404, 687472, 746171, 640840, 654468, 701337, 760635, 721327, 704362, 657362, 717571, 624011, 773369, 761045, 672992, 744705, 667086, 674945, 707703, 663950, 630278, 710340, 645767, 682179, 623197, 689002, 651379, 718123, 697573, 732034, 658828, 738022, 716930, 672781]}], "支出": [{"支出": [304843, 332489, 321045, 325690, 313601, 333915, 337203, 345072, 321137, 303929, 320978, 320441, 319028, 319341, 300875, 322952, 304155, 303453, 340495, 323743, 321044, 323769, 325980, 323484, 319070, 341049, 350710, 331636, 323615, 329762, 323292, 334894, 335763, 321242, 320476, 328542]}], "収支": [{"収支": [378293, 398262, 406359, 361782, 432570, 306925, 317265, 356265, 439498, 417398, 383384, 336921, 398543, 304670, 472494, 438093, 368837, 441252, 326591, 351202, 386659, 340181, 304298, 386856, 326697, 341130, 272487, 357366, 327764, 388361, 374281, 397140, 323065, 416780, 396454, 344239]}], "収入項目": [{"給与A": [517373, 548867, 531616, 584865, 583619, 512560, 530635, 537082, 571464, 564473, 543186, 534529, 519776, 508633, 588642, 578093, 536410, 556733, 512352, 503509, 522599, 559642, 526163, 544672, 534400, 579299, 521635, 579727, 527761, 590786, 522062, 564144, 516708, 599610, 526032, 538605]}, {"給与B": [165763, 181884, 195788, 102607, 162552, 128280, 123833, 164255, 189171, 156854, 161176, 122833, 197795, 115378, 184727, 182952, 136582, 187972, 154734, 171436, 185104, 104308, 104115, 165668, 111367, 102880, 101562, 109275, 123618, 127337, 175511, 167890, 142120, 138412, 190898, 134176]}], "支出小項目": [{"電気": [5679, 7069, 7145, 6630, 7523, 5766, 7015, 7893, 4119, 5052, 6433, 7127, 4553, 5568, 5396, 4498, 6313, 5450, 4872, 4265, 7415, 7379, 6293, 6594, 7114, 5387, 6070, 5339, 4068, 6515, 7649, 6115, 7233, 6348, 5095, 4879]}, {"ガス": [7946, 6435, 5538, 7630, 4494, 7524, 4271, 4889, 7479, 4616, 5335, 5778, 5528, 7822, 5685, 5629, 5170, 4471, 6650, 4815, 6031, 6867, 4164, 6097, 4154, 7672, 7996, 7197, 5242, 5518, 7590, 7527, 7731, 4158, 6555, 4841]}, {"水道": [4863, 6062, 7010, 6422, 6084, 6138, 5935, 6930, 6310, 5773, 7924, 7128, 5243, 5685, 6287, 7143, 5497, 4243, 7978, 5275, 4491, 5719, 6089, 6232, 5831, 6536, 7801, 5208, 5382, 4120, 7818, 5615, 5941, 5626, 6932, 4429]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"保険": [10542, 10900, 10887, 10036, 10481, 10304, 10807, 10447, 10749, 10312, 10286, 10116, 10242, 10679, 10268, 10157, 10170, 10456, 10653, 10043, 10114, 10465, 10476, 10267, 10682, 10775, 10185, 10864, 10120, 10074, 10187, 10902, 10232, 10056, 10926, 10064]}, {"医療": [8458, 9673, 5776, 5290, 7315, 7881, 7305, 9020, 5571, 6573, 7209, 6389, 7933, 5505, 7204, 6075, 6903, 7156, 7689, 6900, 5400, 7674, 9007, 9043, 6593, 8931, 7961, 9448, 9486, 7971, 5198, 9727, 7641, 6614, 5329, 5638]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}, {"その他": [12840, 18821, 11808, 14319, 13255, 16755, 18128, 13524, 17534, 14238, 11352, 11704, 12791, 19154, 12944, 14560, 11473, 18011, 18663, 19486, 11416, 15917, 14182, 14149, 13669, 18623, 18722, 12332, 15374, 13728, 11650, 18497, 16788, 19740, 12089, 10452]}], "支出大項目": [{"光熱水": [18488, 19566, 19693, 20682, 18101, 19428, 17221, 19712, 17908, 15441, 19692, 20033, 15324, 19075, 17368, 17270, 16980, 14164, 19500, 14355, 17937, 19965, 16546, 18923, 17099, 19595, 21867, 17744, 14692, 16153, 23057, 19257, 20905, 16132, 18582, 14149]}, {"通信": [6511, 7490, 5860, 6267, 6168, 5372, 6389, 6505, 7102, 6498, 4058, 7025, 4735, 5080, 4178, 7780, 4619, 4652, 4353, 6984, 7517, 7201, 4757, 6368, 7874, 7351, 6436, 5847, 5726, 6353, 4078, 6339, 6100, 7332, 6493, 7017]}, {"住居": [110667, 111824, 109965, 110112, 105182, 114232, 111386, 116862, 110884, 104194, 108280, 109411, 109608, 105454, 102391, 111053, 107769, 102802, 113655, 109417, 118113, 100400, 117159, 115660, 109016, 113946, 119617, 113246, 119254, 108433, 105804, 116947, 101102, 103961, 108631, 108489]}, {"医療・保険": [19000, 20573, 16663, 15326, 17796, 18185, 18112, 19467, 16320, 16885, 17495, 16505, 18175, 16184, 17472, 16232, 17073, 17612, 18342, 16943, 15514, 18139, 19483, 19310, 17275, 19706, 18146, 20312, 19606, 18045, 15385, 20629, 17873, 16670, 16255, 15702]}, {"食料品": [50628, 55645, 67851, 54684, 56623, 66083, 53670, 67383, 52866, 53223, 50095, 56587, 61226, 60624, 66642, 59587, 52208, 52240, 65995, 53745, 55835, 64419, 51239, 56175, 52774, 54363, 65235, 64941, 51332, 60295, 68801, 55982, 65274, 62048, 69700, 67402]}, {"日用雑貨": [11624, 11303, 11691, 14636, 14837, 18554, 15578, 16242, 12102, 12431, 17596, 14089, 14144, 12816, 12181, 17483, 10165, 14334, 12855, 19834, 13095, 17642, 17761, 17278, 15954, 19048, 16111, 16697, 18055, 13945, 18600, 15525, 13053, 11512, 15236, 16908]}, {"交通": [14519, 12194, 11320, 14525, 16899, 12651, 19389, 18474, 15741, 10703, 10899, 10242, 16943, 11336, 10895, 13642, 13180, 12784, 17608, 14774, 11688, 15378, 14189, 10853, 14831, 15102, 18726, 15191, 11904, 10240, 11048, 13719, 14932, 16093, 10557, 17470]}, {"娯楽": [21897, 33296, 26677, 29074, 24994, 26179, 32245, 25318, 34505, 29456, 33923, 26630, 30050, 31965, 22905, 24055, 25272, 21164, 26368, 25080, 29282, 27076, 28742, 30078, 33443, 33427, 23332, 22138, 28547, 36317, 30249, 30881, 36498, 29043, 28849, 35908]}, {"交際": [38669, 41777, 39517, 46065, 39746, 36476, 45085, 41585, 36175, 40860, 47588, 48215, 36032, 37653, 33899, 41290, 45416, 45690, 43156, 43125, 40647, 37632, 41922, 34690, 37135, 39888, 42518, 43188, 39125, 46253, 34620, 37118, 43238, 38711, 34084, 35045]}], "資産": [{"資産": [11378293, 11776555, 12182914, 12544696, 12977266, 13284191, 13601456, 13957721, 14397219, 14814617, 15198001, 15534922, 15933465, 16238135, 16710629, 17148722, 17517559, 17958811, 18285402, 18636604, 19023263, 19363444, 19667742, 20054598, 20381295, 20722425, 20994912, 21352278, 21680042, 22068403, 22442684, 22839824, 23162889, 23579669, 23976123, 24320362]}]}}'.json()
        }
      })
      .then(function(dataGraph) {
        for(j = 0; j < dataGraph["y"]["支出小項目"].length; j++){
          op = document.createElement("option");
          op.value = j;
          op.text = Object.keys(dataGraph["y"]["支出小項目"][j])[0]
          document.getElementById("sishutuList").appendChild(op)
        }
      });

    // 初期表示
    update(true)

    // ラジオボックスチェック時の処理
    $('input[name="radio"]:radio').change(function(){
      update(false)
    });

    // セレクトボックス(期間)変更時の処理
    $("#dataLen").change(function(){
      update(false)
    });

    // セレクトボックス(支出小項目)変更時の処理
    $("#sishutuList").change(function(){
      var element = document.getElementById("支出小項目");
      element.checked = true ;
      update(false)
    });
  </script>
</body>
</html>
